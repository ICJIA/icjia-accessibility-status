"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[5430],{1359:(e,s,d)=>{d.r(s),d.d(s,{assets:()=>t,contentTitle:()=>l,default:()=>a,frontMatter:()=>c,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"database-schema","title":"Database Schema","description":"Overview of the ICJIA Accessibility Portal database schema.","source":"@site/docs/database-schema.md","sourceDirName":".","slug":"/database-schema","permalink":"/docs/docs/database-schema","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/database-schema.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Authentication System","permalink":"/docs/docs/authentication"},"next":{"title":"System Architecture","permalink":"/docs/docs/architecture"}}');var n=d(2540),r=d(3023);const c={},l="Database Schema",t={},h=[{value:"Tables",id:"tables",level:2},{value:"admin_users",id:"admin_users",level:3},{value:"sessions",id:"sessions",level:3},{value:"sites",id:"sites",level:3},{value:"score_history",id:"score_history",level:3},{value:"api_keys",id:"api_keys",level:3},{value:"activity_log",id:"activity_log",level:3},{value:"api_payloads",id:"api_payloads",level:3},{value:"Relationships",id:"relationships",level:2},{value:"Row Level Security (RLS)",id:"row-level-security-rls",level:2},{value:"Indexes",id:"indexes",level:2},{value:"Migrations",id:"migrations",level:2},{value:"Backup Strategy",id:"backup-strategy",level:2},{value:"See Also",id:"see-also",level:2}];function x(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"database-schema",children:"Database Schema"})}),"\n",(0,n.jsx)(s.p,{children:"Overview of the ICJIA Accessibility Portal database schema."}),"\n",(0,n.jsx)(s.h2,{id:"tables",children:"Tables"}),"\n",(0,n.jsx)(s.h3,{id:"admin_users",children:"admin_users"}),"\n",(0,n.jsx)(s.p,{children:"Stores admin user accounts."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"username"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Unique username"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"password_hash"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Bcrypt password hash"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"updated_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Last update timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"username"})," is unique"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"password_hash"})," is required"]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"sessions",children:"sessions"}),"\n",(0,n.jsx)(s.p,{children:"Stores active user sessions."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"admin_user_id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Foreign key to admin_users"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"token"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Session token"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"expires_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Session expiration time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"admin_user_id"})," references ",(0,n.jsx)(s.code,{children:"admin_users.id"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"token"})," is unique"]}),"\n",(0,n.jsx)(s.li,{children:"Sessions expire after 15 days"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"sites",children:"sites"}),"\n",(0,n.jsx)(s.p,{children:"Stores monitored websites."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"name"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Site name"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"url"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Site URL"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"axe_score"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Axe accessibility score (0-100)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"lighthouse_score"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Lighthouse score (0-100)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"updated_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Last update timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"name"})," is unique"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"url"})," is unique"]}),"\n",(0,n.jsx)(s.li,{children:"Scores are between 0-100"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"score_history",children:"score_history"}),"\n",(0,n.jsx)(s.p,{children:"Stores historical accessibility scores."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"site_id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Foreign key to sites"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"axe_score"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Axe score at this time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"lighthouse_score"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"Lighthouse score at this time"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"recorded_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"When score was recorded"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"site_id"})," references ",(0,n.jsx)(s.code,{children:"sites.id"})]}),"\n",(0,n.jsx)(s.li,{children:"Scores are between 0-100"}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"api_keys",children:"api_keys"}),"\n",(0,n.jsx)(s.p,{children:"Stores API keys for programmatic access."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"admin_user_id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Foreign key to admin_users"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"name"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Key name"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"key_hash"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Hashed API key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"scopes"})}),(0,n.jsx)(s.td,{children:"TEXT[]"}),(0,n.jsx)(s.td,{children:"Array of permission scopes"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"expires_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Optional expiration date"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"last_used_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Last usage timestamp"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"admin_user_id"})," references ",(0,n.jsx)(s.code,{children:"admin_users.id"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"key_hash"})," is unique"]}),"\n",(0,n.jsxs)(s.li,{children:["Scopes: ",(0,n.jsx)(s.code,{children:"sites:read"}),", ",(0,n.jsx)(s.code,{children:"sites:write"}),", ",(0,n.jsx)(s.code,{children:"sites:delete"})]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"activity_log",children:"activity_log"}),"\n",(0,n.jsx)(s.p,{children:"Stores audit trail of all actions."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"admin_user_id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Foreign key to admin_users"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"action"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Action performed"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"resource_type"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"Type of resource (site, user, key)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"resource_id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"ID of affected resource"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"details"})}),(0,n.jsx)(s.td,{children:"JSONB"}),(0,n.jsx)(s.td,{children:"Additional details"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"admin_user_id"})," references ",(0,n.jsx)(s.code,{children:"admin_users.id"})]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"api_payloads",children:"api_payloads"}),"\n",(0,n.jsx)(s.p,{children:"Stores API request payloads for audit trail."}),"\n",(0,n.jsxs)(s.table,{children:[(0,n.jsx)(s.thead,{children:(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.th,{children:"Column"}),(0,n.jsx)(s.th,{children:"Type"}),(0,n.jsx)(s.th,{children:"Description"})]})}),(0,n.jsxs)(s.tbody,{children:[(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Primary key"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"api_key_id"})}),(0,n.jsx)(s.td,{children:"UUID"}),(0,n.jsx)(s.td,{children:"Foreign key to api_keys"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"endpoint"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"API endpoint called"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"method"})}),(0,n.jsx)(s.td,{children:"VARCHAR"}),(0,n.jsx)(s.td,{children:"HTTP method (GET, POST, etc)"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"payload"})}),(0,n.jsx)(s.td,{children:"JSONB"}),(0,n.jsx)(s.td,{children:"Request payload"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"response_status"})}),(0,n.jsx)(s.td,{children:"INTEGER"}),(0,n.jsx)(s.td,{children:"HTTP response status"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"description"})}),(0,n.jsx)(s.td,{children:"TEXT"}),(0,n.jsx)(s.td,{children:"User-provided description"})]}),(0,n.jsxs)(s.tr,{children:[(0,n.jsx)(s.td,{children:(0,n.jsx)(s.code,{children:"created_at"})}),(0,n.jsx)(s.td,{children:"TIMESTAMP"}),(0,n.jsx)(s.td,{children:"Creation timestamp"})]})]})]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Constraints:"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"api_key_id"})," references ",(0,n.jsx)(s.code,{children:"api_keys.id"})]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"relationships",children:"Relationships"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"admin_users\n  \u251c\u2500 sessions (1:N)\n  \u251c\u2500 api_keys (1:N)\n  \u2514\u2500 activity_log (1:N)\n\nsites\n  \u2514\u2500 score_history (1:N)\n\napi_keys\n  \u2514\u2500 api_payloads (1:N)\n"})}),"\n",(0,n.jsx)(s.h2,{id:"row-level-security-rls",children:"Row Level Security (RLS)"}),"\n",(0,n.jsx)(s.p,{children:"All tables have RLS policies enabled:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"admin_users"}),": Only authenticated admins can read"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"sessions"}),": Only the session owner can read"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"sites"}),": Authenticated admins can read/write"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"score_history"}),": Authenticated admins can read/write"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"api_keys"}),": Only the key owner can read"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"activity_log"}),": Authenticated admins can read"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"api_payloads"}),": Authenticated admins can read"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"indexes",children:"Indexes"}),"\n",(0,n.jsx)(s.p,{children:"Indexes are created for frequently queried columns:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"admin_users.username"})," - For login queries"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"sessions.token"})," - For session validation"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"sites.name"})," - For site lookup"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"sites.url"})," - For duplicate detection"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"api_keys.key_hash"})," - For API key validation"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"activity_log.admin_user_id"})," - For audit trail"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"api_payloads.api_key_id"})," - For payload lookup"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"migrations",children:"Migrations"}),"\n",(0,n.jsx)(s.p,{children:"Database schema is created and updated via migration files:"}),"\n",(0,n.jsxs)(s.ol,{children:["\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"step_1_create_initial_schema.sql"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Creates all tables"}),"\n",(0,n.jsx)(s.li,{children:"Sets up RLS policies"}),"\n",(0,n.jsx)(s.li,{children:"Creates indexes"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"step_2_api_keys_and_rls_fixes.sql"})}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Adds API keys table"}),"\n",(0,n.jsx)(s.li,{children:"Fixes RLS policies"}),"\n",(0,n.jsx)(s.li,{children:"Adds activity logging"}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(s.li,{children:["\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"step_3_refactor_to_api_payloads.sql"})," (optional)"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Refactors to use api_payloads table"}),"\n",(0,n.jsx)(s.li,{children:"Updates RLS policies"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"backup-strategy",children:"Backup Strategy"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"Supabase provides automated daily backups"}),"\n",(0,n.jsx)(s.li,{children:"Backups are retained for 7 days"}),"\n",(0,n.jsx)(s.li,{children:"Manual backups can be created anytime"}),"\n",(0,n.jsx)(s.li,{children:"Export data regularly for archival"}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"see-also",children:"See Also"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"./setup-guide",children:"Setup Guide"})," - How to set up the database"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"./api/overview",children:"API Documentation"})," - API reference"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.a,{href:"./troubleshooting/database-errors",children:"Database Errors"})," - Troubleshooting"]}),"\n"]})]})}function a(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(x,{...e})}):x(e)}},3023:(e,s,d)=>{d.d(s,{R:()=>c,x:()=>l});var i=d(3696);const n={},r=i.createContext(n);function c(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:c(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);