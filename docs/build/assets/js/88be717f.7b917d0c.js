"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[7815],{3023:(e,n,o)=>{o.d(n,{R:()=>t,x:()=>a});var s=o(3696);const i={},r=s.createContext(i);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(r.Provider,{value:n},e.children)}},7316:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"deployment/nginx","title":"Nginx Configuration","description":"Guide to configuring Nginx as a reverse proxy for the ICJIA Accessibility Portal.","source":"@site/docs/deployment/nginx.md","sourceDirName":"deployment","slug":"/deployment/nginx","permalink":"/docs/docs/deployment/nginx","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/deployment/nginx.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Production Deployment","permalink":"/docs/docs/deployment/production"},"next":{"title":"PM2 Configuration","permalink":"/docs/docs/deployment/pm2"}}');var i=o(2540),r=o(3023);const t={},a="Nginx Configuration",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Basic Configuration",id:"basic-configuration",level:2},{value:"File Location",id:"file-location",level:3},{value:"Minimal Configuration",id:"minimal-configuration",level:3},{value:"Production Configuration with SSL",id:"production-configuration-with-ssl",level:2},{value:"Installation",id:"installation",level:2},{value:"Copy Configuration",id:"copy-configuration",level:3},{value:"Test Configuration",id:"test-configuration",level:3},{value:"Reload Nginx",id:"reload-nginx",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Connection refused&quot; Error",id:"connection-refused-error",level:3},{value:"&quot;Bad Gateway&quot; Error",id:"bad-gateway-error",level:3},{value:"SSL Certificate Issues",id:"ssl-certificate-issues",level:3},{value:"Slow Response Times",id:"slow-response-times",level:3},{value:"Performance Tuning",id:"performance-tuning",level:2},{value:"Enable Gzip Compression",id:"enable-gzip-compression",level:3},{value:"Enable Caching",id:"enable-caching",level:3},{value:"Connection Pooling",id:"connection-pooling",level:3},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"nginx-configuration",children:"Nginx Configuration"})}),"\n",(0,i.jsx)(n.p,{children:"Guide to configuring Nginx as a reverse proxy for the ICJIA Accessibility Portal."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Nginx acts as a reverse proxy, routing requests to the appropriate backend service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Client Request\n    \u2193\nNginx (Port 80/443)\n    \u251c\u2500 / \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2192 Frontend (5173)\n    \u251c\u2500 /api/ \u2500\u2500\u2500\u2500\u2500\u2500\u2192 Backend (3001)\n    \u2514\u2500 /docs/ \u2500\u2500\u2500\u2500\u2500\u2192 Docs (3002)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"file-location",children:"File Location"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/nginx/sites-available/icjia-accessibility.conf\n"})}),"\n",(0,i.jsx)(n.h3,{id:"minimal-configuration",children:"Minimal Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"upstream frontend {\n    server localhost:5173;\n}\n\nupstream backend {\n    server localhost:3001;\n}\n\nupstream docs {\n    server localhost:3002;\n}\n\nserver {\n    listen 80;\n    server_name example.com www.example.com;\n\n    # Frontend (root)\n    location / {\n        proxy_pass http://frontend;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n\n    # Backend API\n    location /api/ {\n        proxy_pass http://backend/api/;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # Documentation\n    location /docs/ {\n        proxy_pass http://docs/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"production-configuration-with-ssl",children:"Production Configuration with SSL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'# Redirect HTTP to HTTPS\nserver {\n    listen 80;\n    server_name example.com www.example.com;\n    return 301 https://$server_name$request_uri;\n}\n\n# HTTPS server\nserver {\n    listen 443 ssl http2;\n    server_name example.com www.example.com;\n\n    # SSL Certificates\n    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\n\n    # SSL Configuration\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n    ssl_session_cache shared:SSL:10m;\n    ssl_session_timeout 10m;\n\n    # Security Headers\n    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;\n    add_header X-Frame-Options "SAMEORIGIN" always;\n    add_header X-Content-Type-Options "nosniff" always;\n    add_header X-XSS-Protection "1; mode=block" always;\n\n    # Upstream services\n    upstream frontend {\n        server localhost:5173;\n    }\n\n    upstream backend {\n        server localhost:3001;\n    }\n\n    upstream docs {\n        server localhost:3002;\n    }\n\n    # Frontend (root)\n    location / {\n        proxy_pass http://frontend;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \'upgrade\';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n\n    # Backend API\n    location /api/ {\n        proxy_pass http://backend/api/;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        # Timeouts for long-running requests\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # Documentation\n    location /docs/ {\n        proxy_pass http://docs/;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \'upgrade\';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n\n    # Deny access to sensitive files\n    location ~ /\\. {\n        deny all;\n    }\n\n    location ~ ~$ {\n        deny all;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"copy-configuration",children:"Copy Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Copy the configuration file\nsudo cp nginx/icjia-accessibility.conf /etc/nginx/sites-available/\n\n# Create symlink to enable site\nsudo ln -s /etc/nginx/sites-available/icjia-accessibility.conf \\\n  /etc/nginx/sites-enabled/\n\n# Remove default site (optional)\nsudo rm /etc/nginx/sites-enabled/default\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-configuration",children:"Test Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Test Nginx configuration\nsudo nginx -t\n\n# Expected output:\n# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\n# nginx: configuration file /etc/nginx/nginx.conf test is successful\n"})}),"\n",(0,i.jsx)(n.h3,{id:"reload-nginx",children:"Reload Nginx"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Reload Nginx\nsudo systemctl reload nginx\n\n# Or restart\nsudo systemctl restart nginx\n\n# Verify status\nsudo systemctl status nginx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"connection-refused-error",children:'"Connection refused" Error'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem:"})," Nginx can't connect to upstream services"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Verify services are running\npm2 status\n\n# Check if ports are listening\nsudo lsof -i :5173\nsudo lsof -i :3001\nsudo lsof -i :3002\n\n# Restart services if needed\npm2 restart all\n"})}),"\n",(0,i.jsx)(n.h3,{id:"bad-gateway-error",children:'"Bad Gateway" Error'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem:"})," Upstream service is down or not responding"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check service logs\npm2 logs\n\n# Restart services\npm2 restart all\n\n# Check Nginx error log\nsudo tail -f /var/log/nginx/error.log\n"})}),"\n",(0,i.jsx)(n.h3,{id:"ssl-certificate-issues",children:"SSL Certificate Issues"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem:"})," SSL certificate not working"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Verify certificate exists\nsudo ls -la /etc/letsencrypt/live/example.com/\n\n# Renew certificate\nsudo certbot renew\n\n# Test renewal\nsudo certbot renew --dry-run\n"})}),"\n",(0,i.jsx)(n.h3,{id:"slow-response-times",children:"Slow Response Times"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Problem:"})," Requests are slow"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Increase timeouts in Nginx config\nproxy_connect_timeout 60s;\nproxy_send_timeout 60s;\nproxy_read_timeout 60s;\n\n# Reload Nginx\nsudo systemctl reload nginx\n\n# Check upstream service performance\npm2 monit\n"})}),"\n",(0,i.jsx)(n.h2,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,i.jsx)(n.h3,{id:"enable-gzip-compression",children:"Enable Gzip Compression"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"gzip on;\ngzip_types text/plain text/css text/javascript application/json;\ngzip_min_length 1000;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"enable-caching",children:"Enable Caching"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m;\n\nlocation / {\n    proxy_cache my_cache;\n    proxy_cache_valid 200 10m;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:"upstream backend {\n    server localhost:3001;\n    keepalive 32;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./overview",children:"Deployment Overview"})," - Deployment guide"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./production",children:"Production Deployment"})," - Production setup"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./pm2",children:"PM2 Configuration"})," - Process management"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);