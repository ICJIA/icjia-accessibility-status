"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[6695],{3023:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var i=s(3696);const l={},r=i.createContext(l);function c(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),i.createElement(r.Provider,{value:n},e.children)}},9187:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"deployment/deployment-scripts-reference","title":"Deployment Scripts Reference","description":"Quick reference for all deployment-related scripts and commands.","source":"@site/docs/deployment/deployment-scripts-reference.md","sourceDirName":"deployment","slug":"/deployment/deployment-scripts-reference","permalink":"/docs/docs/deployment/deployment-scripts-reference","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/deployment/deployment-scripts-reference.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Forge Deployment Script Setup","permalink":"/docs/docs/deployment/forge-deployment-script"},"next":{"title":"Production Deployment","permalink":"/docs/docs/deployment/production"}}');var l=s(2540),r=s(3023);const c={sidebar_position:4},t="Deployment Scripts Reference",o={},a=[{value:"Package.json Scripts",id:"packagejson-scripts",level:2},{value:"Development Scripts",id:"development-scripts",level:3},{value:"Build Scripts",id:"build-scripts",level:3},{value:"PM2 Management Scripts",id:"pm2-management-scripts",level:3},{value:"Deployment Script (NEW)",id:"deployment-script-new",level:3},{value:"Other Scripts",id:"other-scripts",level:3},{value:"Bash Deployment Script",id:"bash-deployment-script",level:2},{value:"File: <code>deploy-forge.sh</code>",id:"file-deploy-forgesh",level:3},{value:"PM2 Configuration",id:"pm2-configuration",level:2},{value:"File: <code>ecosystem.config.js</code>",id:"file-ecosystemconfigjs",level:3},{value:"1. Backend Service",id:"1-backend-service",level:4},{value:"2. Documentation Service",id:"2-documentation-service",level:4},{value:"Deployment Workflow",id:"deployment-workflow",level:2},{value:"Automatic Deployment (GitHub Webhook)",id:"automatic-deployment-github-webhook",level:3},{value:"Manual Deployment",id:"manual-deployment",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Required Variables",id:"required-variables",level:3},{value:"Set in Forge",id:"set-in-forge",level:3},{value:"Set on Server",id:"set-on-server",level:3},{value:"Verification Commands",id:"verification-commands",level:2},{value:"Check Services",id:"check-services",level:3},{value:"Check Endpoints",id:"check-endpoints",level:3},{value:"Check Logs",id:"check-logs",level:3},{value:"Troubleshooting Commands",id:"troubleshooting-commands",level:2},{value:"Services Not Running",id:"services-not-running",level:3},{value:"Build Failed",id:"build-failed",level:3},{value:"Port Conflicts",id:"port-conflicts",level:3},{value:"Deployment Script Issues",id:"deployment-script-issues",level:3},{value:"Deployment Checklist",id:"deployment-checklist",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"First Time Setup",id:"first-time-setup",level:3},{value:"Enable Automatic Deployments",id:"enable-automatic-deployments",level:3},{value:"Monitor Deployments",id:"monitor-deployments",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"deployment-scripts-reference",children:"Deployment Scripts Reference"})}),"\n",(0,l.jsx)(n.p,{children:"Quick reference for all deployment-related scripts and commands."}),"\n",(0,l.jsx)(n.h2,{id:"packagejson-scripts",children:"Package.json Scripts"}),"\n",(0,l.jsx)(n.h3,{id:"development-scripts",children:"Development Scripts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Start all services in development mode\nyarn dev\n\n# Start only frontend (Vite on 5173)\nyarn dev:frontend\n\n# Start only backend (Express on 3001)\nyarn dev:backend\n\n# Start only documentation (Docusaurus on 3002)\nyarn dev:docs\n\n# Start all services separately\nyarn dev:all\n"})}),"\n",(0,l.jsx)(n.h3,{id:"build-scripts",children:"Build Scripts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Build frontend and documentation\nyarn build\n\n# Build frontend only\nyarn build:frontend\n\n# Build documentation only\nyarn build:docs\n\n# Build backend (no-op, uses tsx runtime)\nyarn build:backend\n"})}),"\n",(0,l.jsx)(n.h3,{id:"pm2-management-scripts",children:"PM2 Management Scripts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Start all services with PM2\nyarn start\n\n# Stop all services\nyarn stop\n\n# Restart all services\nyarn restart\n\n# View backend logs\nyarn logs\n\n# Check PM2 status\nyarn status\n"})}),"\n",(0,l.jsx)(n.h3,{id:"deployment-script-new",children:"Deployment Script (NEW)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Run complete deployment (used by Forge)\nyarn forge\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"What it does:"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"yarn install --production"})," - Install production dependencies"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"yarn build"})," - Build frontend and documentation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pm2 restart ecosystem.config.js"})," - Restart services"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pm2 save"})," - Save process list"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Used by:"})," Laravel Forge deployment webhook"]}),"\n",(0,l.jsx)(n.h3,{id:"other-scripts",children:"Other Scripts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Lint code\nyarn lint\n\n# Type checking\nyarn typecheck\n\n# Seed database\nyarn seed\n\n# Reset users\nyarn reset:users\n\n# Reset entire app\nyarn reset:app\n"})}),"\n",(0,l.jsx)(n.h2,{id:"bash-deployment-script",children:"Bash Deployment Script"}),"\n",(0,l.jsxs)(n.h3,{id:"file-deploy-forgesh",children:["File: ",(0,l.jsx)(n.code,{children:"deploy-forge.sh"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Location:"})," ",(0,l.jsx)(n.code,{children:"/home/forge/accessibility.icjia.app/deploy-forge.sh"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Execution:"})," Called by Laravel Forge when GitHub webhook is triggered"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"12-Step Process:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"1. Navigate to site directory\n2. Pull latest code from GitHub\n3. Verify Yarn installation\n4. Install production dependencies\n5. Build frontend and documentation\n6. Verify build artifacts\n7. Verify PM2 installation\n8. Restart PM2 services\n9. Save PM2 process list\n10. Verify services are running\n11. Verify ports are listening\n12. Display PM2 status\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Features:"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Color-coded logging"}),"\n",(0,l.jsx)(n.li,{children:"Error handling with rollback"}),"\n",(0,l.jsx)(n.li,{children:"Service verification"}),"\n",(0,l.jsxs)(n.li,{children:["Detailed logging to ",(0,l.jsx)(n.code,{children:"/home/forge/.pm2/logs/deployment.log"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Manual Execution:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\ncd /home/forge/accessibility.icjia.app\nbash deploy-forge.sh\n"})}),"\n",(0,l.jsx)(n.h2,{id:"pm2-configuration",children:"PM2 Configuration"}),"\n",(0,l.jsxs)(n.h3,{id:"file-ecosystemconfigjs",children:["File: ",(0,l.jsx)(n.code,{children:"ecosystem.config.js"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Services Managed:"})}),"\n",(0,l.jsx)(n.h4,{id:"1-backend-service",children:"1. Backend Service"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'icjia-accessibility-backend',\n  script: 'server/index.ts',\n  interpreter: 'tsx',\n  port: 3001,\n  env: { NODE_ENV: 'production' }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"2-documentation-service",children:"2. Documentation Service"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'icjia-accessibility-docs',\n  script: 'yarn',\n  args: 'workspace icjia-accessibility-docs start',\n  port: 3002,\n  env: { NODE_ENV: 'production' }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Common PM2 Commands:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Start all services\npm2 start ecosystem.config.js\n\n# Restart all services\npm2 restart ecosystem.config.js\n\n# Stop all services\npm2 stop ecosystem.config.js\n\n# Delete all services\npm2 delete ecosystem.config.js\n\n# View status\npm2 status\n\n# View logs\npm2 logs\n\n# View specific service logs\npm2 logs icjia-accessibility-backend\npm2 logs icjia-accessibility-docs\n\n# Monitor in real-time\npm2 monit\n\n# Save process list\npm2 save\n\n# Setup startup on reboot\npm2 startup\n"})}),"\n",(0,l.jsx)(n.h2,{id:"deployment-workflow",children:"Deployment Workflow"}),"\n",(0,l.jsx)(n.h3,{id:"automatic-deployment-github-webhook",children:"Automatic Deployment (GitHub Webhook)"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Trigger:"})," Push to ",(0,l.jsx)(n.code,{children:"main"})," branch"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'git add .\ngit commit -m "Your changes"\ngit push origin main\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Flow:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GitHub webhook\n    \u2193\nForge receives webhook\n    \u2193\nForge executes: bash deploy-forge.sh\n    \u2193\nScript pulls latest code\n    \u2193\nScript runs: yarn forge\n    \u2193\nServices restarted\n    \u2193\nNew version live\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Time:"})," ~2-3 minutes"]}),"\n",(0,l.jsx)(n.h3,{id:"manual-deployment",children:"Manual Deployment"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Option 1: Using Forge UI"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Go to Site Details \u2192 Deployment"}),"\n",(0,l.jsx)(n.li,{children:'Click "Deploy Now"'}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Option 2: SSH and run script"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\ncd /home/forge/accessibility.icjia.app\nbash deploy-forge.sh\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Option 3: SSH and run yarn command"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\ncd /home/forge/accessibility.icjia.app\nyarn forge\n"})}),"\n",(0,l.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,l.jsx)(n.h3,{id:"required-variables",children:"Required Variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Supabase\nVITE_SUPABASE_URL=https://your-project-ref.supabase.co\nVITE_SUPABASE_ANON_KEY=your-supabase-anon-key\n\n# API Configuration\nVITE_API_URL=https://accessibility.icjia.app/api\nFRONTEND_URL=https://accessibility.icjia.app\n\n# Server\nNODE_ENV=production\nPORT=3001\n"})}),"\n",(0,l.jsx)(n.h3,{id:"set-in-forge",children:"Set in Forge"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Go to Site Details \u2192 Environment"}),"\n",(0,l.jsx)(n.li,{children:"Add each variable"}),"\n",(0,l.jsx)(n.li,{children:"Click Save"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"set-on-server",children:"Set on Server"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\nnano /home/forge/accessibility.icjia.app/.env\n"})}),"\n",(0,l.jsx)(n.h2,{id:"verification-commands",children:"Verification Commands"}),"\n",(0,l.jsx)(n.h3,{id:"check-services",children:"Check Services"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# SSH into server\nssh forge@your-server-ip\n\n# Check PM2 status\npm2 status\n\n# Check if ports are listening\nlsof -i :3001\nlsof -i :3002\n\n# Check if processes are running\nps aux | grep node\nps aux | grep yarn\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-endpoints",children:"Check Endpoints"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Frontend\ncurl https://accessibility.icjia.app\n\n# API Health\ncurl https://accessibility.icjia.app/api/health\n\n# Documentation\ncurl https://accessibility.icjia.app/docs\n"})}),"\n",(0,l.jsx)(n.h3,{id:"check-logs",children:"Check Logs"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Backend logs\npm2 logs icjia-accessibility-backend\n\n# Documentation logs\npm2 logs icjia-accessibility-docs\n\n# Deployment logs\ntail -f /home/forge/.pm2/logs/deployment.log\n\n# Nginx error logs\nsudo tail -f /var/log/nginx/accessibility.icjia.app-error.log\n"})}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting-commands",children:"Troubleshooting Commands"}),"\n",(0,l.jsx)(n.h3,{id:"services-not-running",children:"Services Not Running"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check status\npm2 status\n\n# Restart services\npm2 restart ecosystem.config.js\n\n# Start services\npm2 start ecosystem.config.js\n\n# Check logs\npm2 logs\n"})}),"\n",(0,l.jsx)(n.h3,{id:"build-failed",children:"Build Failed"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check if dist directory exists\nls -la dist/\n\n# Try building manually\nyarn build\n\n# Check for errors\nyarn build 2>&1 | tail -20\n"})}),"\n",(0,l.jsx)(n.h3,{id:"port-conflicts",children:"Port Conflicts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check what's using port 3001\nlsof -i :3001\n\n# Check what's using port 3002\nlsof -i :3002\n\n# Kill process using port (if needed)\nkill -9 <PID>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"deployment-script-issues",children:"Deployment Script Issues"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Check deployment log\ntail -f /home/forge/.pm2/logs/deployment.log\n\n# Run script manually with output\nbash deploy-forge.sh\n\n# Check script permissions\nls -la deploy-forge.sh\n\n# Make executable if needed\nchmod +x deploy-forge.sh\n"})}),"\n",(0,l.jsx)(n.h2,{id:"deployment-checklist",children:"Deployment Checklist"}),"\n",(0,l.jsx)(n.p,{children:"Before first deployment:"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"package.json"})," has 'forge' script"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"ecosystem.config.js"})," has both services"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"deploy-forge.sh"})," uploaded to server"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,l.jsx)(n.code,{children:"deploy-forge.sh"})," is executable (",(0,l.jsx)(n.code,{children:"chmod +x"}),")"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Environment variables set in Forge"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Deployment script configured in Forge"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","GitHub webhook enabled"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Manual deployment tested"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All endpoints verified"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","PM2 logs show no errors"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,l.jsx)(n.h3,{id:"first-time-setup",children:"First Time Setup"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# 1. Upload deploy-forge.sh\nscp deploy-forge.sh forge@your-server-ip:/home/forge/accessibility.icjia.app/\n\n# 2. Make executable\nssh forge@your-server-ip\nchmod +x /home/forge/accessibility.icjia.app/deploy-forge.sh\n\n# 3. Test manual deployment\nbash /home/forge/accessibility.icjia.app/deploy-forge.sh\n\n# 4. Verify services\npm2 status\n"})}),"\n",(0,l.jsx)(n.h3,{id:"enable-automatic-deployments",children:"Enable Automatic Deployments"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"In Forge: Site Details \u2192 Deployment Script"}),"\n",(0,l.jsxs)(n.li,{children:["Add: ",(0,l.jsx)(n.code,{children:"bash deploy-forge.sh"})]}),"\n",(0,l.jsx)(n.li,{children:"In Forge: Site Details \u2192 Deployment"}),"\n",(0,l.jsx)(n.li,{children:"Enable GitHub webhook"}),"\n",(0,l.jsx)(n.li,{children:"Test with a commit to main"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"monitor-deployments",children:"Monitor Deployments"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Watch deployment history in Forge\n# Or SSH and check logs:\ntail -f /home/forge/.pm2/logs/deployment.log\npm2 logs\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);