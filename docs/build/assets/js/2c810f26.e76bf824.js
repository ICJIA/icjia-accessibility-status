"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[2861],{3023:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var i=s(3696);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}},5290:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"reset-scripts","title":"Database Reset Scripts","description":"Two powerful reset scripts are available for development environments to help you manage your database state.","source":"@site/docs/reset-scripts.md","sourceDirName":".","slug":"/reset-scripts","permalink":"/docs/docs/reset-scripts","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/reset-scripts.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Development Setup","permalink":"/docs/docs/development-setup"},"next":{"title":"Testing Guide","permalink":"/docs/docs/testing"}}');var r=s(2540),t=s(3023);const l={},c="Database Reset Scripts",d={},a=[{value:"Overview",id:"overview",level:2},{value:"Reset Users Script",id:"reset-users-script",level:2},{value:"Purpose",id:"purpose",level:3},{value:"Usage",id:"usage",level:3},{value:"What Gets Deleted",id:"what-gets-deleted",level:3},{value:"What Gets Preserved",id:"what-gets-preserved",level:3},{value:"Confirmation Process",id:"confirmation-process",level:3},{value:"After Running",id:"after-running",level:3},{value:"Reset App Script",id:"reset-app-script",level:2},{value:"Purpose",id:"purpose-1",level:3},{value:"Usage",id:"usage-1",level:3},{value:"What Gets Deleted",id:"what-gets-deleted-1",level:3},{value:"What Gets Preserved",id:"what-gets-preserved-1",level:3},{value:"Confirmation Process",id:"confirmation-process-1",level:3},{value:"After Running",id:"after-running-1",level:3},{value:"Safety Features",id:"safety-features",level:2},{value:"1. Environment Check",id:"1-environment-check",level:3},{value:"2. Explicit Confirmation",id:"2-explicit-confirmation",level:3},{value:"3. Prominent Warnings",id:"3-prominent-warnings",level:3},{value:"4. Audit Trail",id:"4-audit-trail",level:3},{value:"Common Scenarios",id:"common-scenarios",level:2},{value:"Scenario 1: Locked Out of Admin Account",id:"scenario-1-locked-out-of-admin-account",level:3},{value:"Scenario 2: Testing Admin Creation Flow",id:"scenario-2-testing-admin-creation-flow",level:3},{value:"Scenario 3: Clearing Old Test Data",id:"scenario-3-clearing-old-test-data",level:3},{value:"Scenario 4: Complete Fresh Start",id:"scenario-4-complete-fresh-start",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Script Won&#39;t Run",id:"script-wont-run",level:3},{value:"Incorrect Confirmation Phrase",id:"incorrect-confirmation-phrase",level:3},{value:"Database Connection Error",id:"database-connection-error",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"database-reset-scripts",children:"Database Reset Scripts"})}),"\n",(0,r.jsx)(n.p,{children:"Two powerful reset scripts are available for development environments to help you manage your database state."}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["These scripts are ",(0,r.jsx)(n.strong,{children:"development only"})," and will not run in production environments. They require explicit confirmation to prevent accidental data loss."]})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Script"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Data Deleted"}),(0,r.jsx)(n.th,{children:"Data Preserved"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"reset:users"})}),(0,r.jsx)(n.td,{children:"Reset admin access"}),(0,r.jsx)(n.td,{children:"Admin users, API keys, sessions"}),(0,r.jsx)(n.td,{children:"Sites, history, logs, documentation"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"reset:app"})}),(0,r.jsx)(n.td,{children:"Complete wipe"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Everything"})}),(0,r.jsx)(n.td,{children:"Nothing"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"reset-users-script",children:"Reset Users Script"}),"\n",(0,r.jsx)(n.h3,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsx)(n.p,{children:"Reset all admin users, API keys, and sessions while preserving all site data, score history, and activity logs."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use this when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You need to reset admin credentials"}),"\n",(0,r.jsx)(n.li,{children:"You want to clear all API keys"}),"\n",(0,r.jsx)(n.li,{children:"You're testing the admin creation flow"}),"\n",(0,r.jsx)(n.li,{children:"You need to start fresh with new admin accounts"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn reset:users\n"})}),"\n",(0,r.jsx)(n.h3,{id:"what-gets-deleted",children:"What Gets Deleted"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2717 ALL admin users (including the primary admin)"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL API keys"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL active sessions"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"what-gets-preserved",children:"What Gets Preserved"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2713 All sites and their data"}),"\n",(0,r.jsx)(n.li,{children:"\u2713 All score history and trends"}),"\n",(0,r.jsx)(n.li,{children:"\u2713 All API payloads (audit trail)"}),"\n",(0,r.jsx)(n.li,{children:"\u2713 All activity logs"}),"\n",(0,r.jsx)(n.li,{children:"\u2713 All documentation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"confirmation-process",children:"Confirmation Process"}),"\n",(0,r.jsxs)(n.p,{children:["The script requires ",(0,r.jsx)(n.strong,{children:"two separate confirmations"})," to prevent accidental execution:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"First Confirmation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Type: "I understand this will delete all admin users and API keys"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Second Confirmation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Type: "DELETE ALL USERS NOW"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"after-running",children:"After Running"}),"\n",(0,r.jsx)(n.p,{children:"After the script completes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The application will require creating a new admin user"}),"\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.code,{children:"/admin"})," to create the first admin account"]}),"\n",(0,r.jsx)(n.li,{children:"All existing admin accounts are permanently deleted"}),"\n",(0,r.jsx)(n.li,{children:"All API keys need to be regenerated"}),"\n",(0,r.jsx)(n.li,{children:"Site data remains intact and can be managed by the new admin"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"reset-app-script",children:"Reset App Script"}),"\n",(0,r.jsx)(n.h3,{id:"purpose-1",children:"Purpose"}),"\n",(0,r.jsx)(n.p,{children:'Completely wipe the database and reset it to an empty state. This is the "nuclear option" for starting completely from scratch.'}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use this when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You want to start completely fresh"}),"\n",(0,r.jsx)(n.li,{children:"You're testing the entire initial setup flow"}),"\n",(0,r.jsx)(n.li,{children:"You need to clear all test data"}),"\n",(0,r.jsx)(n.li,{children:"You're preparing for a complete demo reset"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"usage-1",children:"Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn reset:app\n"})}),"\n",(0,r.jsx)(n.h3,{id:"what-gets-deleted-1",children:"What Gets Deleted"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2717 ALL admin users"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL API keys"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL sessions"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL sites and their data"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL score history and trends"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL API payloads (audit trail)"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL activity logs"}),"\n",(0,r.jsx)(n.li,{children:"\u2717 ALL documentation"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"what-gets-preserved-1",children:"What Gets Preserved"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Nothing - the database is completely empty"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"confirmation-process-1",children:"Confirmation Process"}),"\n",(0,r.jsxs)(n.p,{children:["The script requires ",(0,r.jsx)(n.strong,{children:"two separate confirmations"})," to prevent accidental execution:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"First Confirmation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Type: "I understand this will delete everything permanently"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Second Confirmation:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'Type: "DELETE EVERYTHING NOW"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"after-running-1",children:"After Running"}),"\n",(0,r.jsx)(n.p,{children:"After the script completes:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The database is completely empty"}),"\n",(0,r.jsx)(n.li,{children:"You must re-run the migration files to set up the schema"}),"\n",(0,r.jsx)(n.li,{children:"A new admin user will be created with blank password"}),"\n",(0,r.jsx)(n.li,{children:"You'll need to set up everything from scratch"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"safety-features",children:"Safety Features"}),"\n",(0,r.jsx)(n.p,{children:"Both scripts include multiple safety mechanisms:"}),"\n",(0,r.jsx)(n.h3,{id:"1-environment-check",children:"1. Environment Check"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Scripts only run in development environments"}),"\n",(0,r.jsxs)(n.li,{children:["Will not execute if ",(0,r.jsx)(n.code,{children:"NODE_ENV === 'production'"})]}),"\n",(0,r.jsx)(n.li,{children:"Exits with error code 1 if safety checks fail"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-explicit-confirmation",children:"2. Explicit Confirmation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Requires typing exact phrases (not just "yes" or "y")'}),"\n",(0,r.jsx)(n.li,{children:"Two separate confirmation prompts"}),"\n",(0,r.jsx)(n.li,{children:"Case-sensitive phrase matching"}),"\n",(0,r.jsx)(n.li,{children:"Clear error messages if incorrect phrase is entered"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-prominent-warnings",children:"3. Prominent Warnings"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"ASCII box warnings display what will be deleted"}),"\n",(0,r.jsx)(n.li,{children:"Lists what will be preserved"}),"\n",(0,r.jsx)(n.li,{children:"Emphasizes that action cannot be undone"}),"\n",(0,r.jsx)(n.li,{children:"Provides clear next steps after completion"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"4-audit-trail",children:"4. Audit Trail"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Logs deletion progress to console"}),"\n",(0,r.jsx)(n.li,{children:"Shows which tables were deleted"}),"\n",(0,r.jsx)(n.li,{children:"Displays success/error messages"}),"\n",(0,r.jsx)(n.li,{children:"Provides guidance on next steps"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"common-scenarios",children:"Common Scenarios"}),"\n",(0,r.jsx)(n.h3,{id:"scenario-1-locked-out-of-admin-account",children:"Scenario 1: Locked Out of Admin Account"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem:"})," You can't remember the admin password and can't log in."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn reset:users\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then create a new admin account at ",(0,r.jsx)(n.code,{children:"/admin"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"scenario-2-testing-admin-creation-flow",children:"Scenario 2: Testing Admin Creation Flow"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem:"})," You want to test the initial setup and admin creation process."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn reset:users\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then visit ",(0,r.jsx)(n.code,{children:"/admin"})," to test the admin creation flow."]}),"\n",(0,r.jsx)(n.h3,{id:"scenario-3-clearing-old-test-data",children:"Scenario 3: Clearing Old Test Data"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem:"})," You have lots of test sites and want to start fresh but keep the admin account."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# This is not directly supported by the scripts\n# Instead, manually delete sites from the admin panel\n# Or use reset:users to clear everything and recreate\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scenario-4-complete-fresh-start",children:"Scenario 4: Complete Fresh Start"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Problem:"})," You want to completely reset everything and start from scratch."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn reset:app\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then re-run the migration files to set up the schema again."}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"script-wont-run",children:"Script Won't Run"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Error:"}),' "Cannot run in production environment"']}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"These scripts only work in development"}),"\n",(0,r.jsxs)(n.li,{children:["Check that ",(0,r.jsx)(n.code,{children:"NODE_ENV"})," is not set to ",(0,r.jsx)(n.code,{children:"production"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Error:"}),' "Missing environment variables"']}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"SUPABASE_URL"})," and ",(0,r.jsx)(n.code,{children:"SUPABASE_SERVICE_ROLE_KEY"})," are set in ",(0,r.jsx)(n.code,{children:".env"})]}),"\n",(0,r.jsxs)(n.li,{children:["Check that your ",(0,r.jsx)(n.code,{children:".env"})," file exists"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"incorrect-confirmation-phrase",children:"Incorrect Confirmation Phrase"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Error:"}),' "Incorrect phrase. Operation cancelled."']}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The confirmation phrase is case-sensitive"}),"\n",(0,r.jsx)(n.li,{children:"Make sure you typed it exactly as shown"}),"\n",(0,r.jsx)(n.li,{children:"Try again with the exact phrase"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"database-connection-error",children:"Database Connection Error"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Error:"}),' "Failed to connect to database"']}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Verify your Supabase credentials in ",(0,r.jsx)(n.code,{children:".env"})]}),"\n",(0,r.jsx)(n.li,{children:"Check that your Supabase project is active"}),"\n",(0,r.jsx)(n.li,{children:"Ensure you have internet connectivity"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Always backup first"})," - If you have important data, export it before running these scripts"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use in development only"})," - These scripts are designed for development environments"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Understand the consequences"})," - Read what will be deleted before confirming"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Document your setup"})," - Keep notes on how to recreate your setup if needed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test thoroughly"})," - Test the scripts in a development environment first"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./setup-guide",children:"Setup Guide"})," - How to set up the database"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./authentication",children:"Authentication"})," - How the auth system works"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./troubleshooting/common-issues",children:"Troubleshooting"})," - Common issues and solutions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);