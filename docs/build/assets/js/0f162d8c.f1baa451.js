"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[6585],{3023:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(3696);const a={},r=i.createContext(a);function t(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(r.Provider,{value:n},e.children)}},6574:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"deployment/pm2","title":"PM2 Configuration","description":"Guide to using PM2 for process management in production.","source":"@site/docs/deployment/pm2.md","sourceDirName":"deployment","slug":"/deployment/pm2","permalink":"/docs/docs/deployment/pm2","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/deployment/pm2.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Nginx Configuration","permalink":"/docs/docs/deployment/nginx"},"next":{"title":"PM2 Environment Variables","permalink":"/docs/docs/deployment/pm2-environment-variables"}}');var a=s(2540),r=s(3023);const t={},l="PM2 Configuration",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Installation",id:"installation",level:2},{value:"Ecosystem Configuration",id:"ecosystem-configuration",level:2},{value:"Starting Services",id:"starting-services",level:2},{value:"Start All Services",id:"start-all-services",level:3},{value:"Start Individual Service",id:"start-individual-service",level:3},{value:"Managing Services",id:"managing-services",level:2},{value:"View Status",id:"view-status",level:3},{value:"View Logs",id:"view-logs",level:3},{value:"Restart Services",id:"restart-services",level:3},{value:"Stop Services",id:"stop-services",level:3},{value:"Auto-Start on Server Reboot",id:"auto-start-on-server-reboot",level:2},{value:"Setup Startup",id:"setup-startup",level:3},{value:"Save Configuration",id:"save-configuration",level:3},{value:"Disable Auto-Start",id:"disable-auto-start",level:3},{value:"Monitoring",id:"monitoring",level:2},{value:"Real-Time Monitoring",id:"real-time-monitoring",level:3},{value:"Log Rotation",id:"log-rotation",level:3},{value:"Health Monitoring",id:"health-monitoring",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Service Won&#39;t Start",id:"service-wont-start",level:3},{value:"Service Keeps Crashing",id:"service-keeps-crashing",level:3},{value:"High Memory Usage",id:"high-memory-usage",level:3},{value:"Port Already in Use",id:"port-already-in-use",level:3},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Cluster Mode",id:"cluster-mode",level:3},{value:"Watch Mode",id:"watch-mode",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Common Commands",id:"common-commands",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"pm2-configuration",children:"PM2 Configuration"})}),"\n",(0,a.jsx)(n.p,{children:"Guide to using PM2 for process management in production."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"PM2 is a production process manager for Node.js applications. It:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u2705 Keeps applications running"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Auto-restarts on crashes"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Manages multiple processes"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Provides monitoring and logging"}),"\n",(0,a.jsx)(n.li,{children:"\u2705 Handles startup on server reboot"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Install PM2 globally\nnpm install -g pm2\n\n# Verify installation\npm2 --version\n"})}),"\n",(0,a.jsx)(n.h2,{id:"ecosystem-configuration",children:"Ecosystem Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["The project includes ",(0,a.jsx)(n.code,{children:"ecosystem.config.js"})," for managing all three services:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"module.exports = {\n  apps: [\n    {\n      name: 'accessibility-frontend',\n      script: 'yarn',\n      args: 'build && yarn preview',\n      cwd: './',\n      env: {\n        NODE_ENV: 'production',\n        PORT: 5173,\n      },\n    },\n    {\n      name: 'accessibility-backend',\n      script: 'tsx',\n      args: 'server/index.ts',\n      cwd: './',\n      env: {\n        NODE_ENV: 'production',\n        PORT: 3001,\n      },\n    },\n    {\n      name: 'accessibility-docs',\n      script: 'yarn',\n      args: 'build && yarn serve',\n      cwd: './docs',\n      env: {\n        NODE_ENV: 'production',\n        PORT: 3002,\n      },\n    },\n  ],\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"starting-services",children:"Starting Services"}),"\n",(0,a.jsx)(n.h3,{id:"start-all-services",children:"Start All Services"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Start all services defined in ecosystem.config.js\npm2 start ecosystem.config.js --env production\n\n# Verify services started\npm2 status\n"})}),"\n",(0,a.jsx)(n.h3,{id:"start-individual-service",children:"Start Individual Service"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Start specific service\npm2 start ecosystem.config.js --only accessibility-backend\n\n# Start by name\npm2 start app.js --name "my-app"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"managing-services",children:"Managing Services"}),"\n",(0,a.jsx)(n.h3,{id:"view-status",children:"View Status"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View all processes\npm2 status\n\n# View detailed information\npm2 info accessibility-backend\n\n# View real-time monitoring\npm2 monit\n"})}),"\n",(0,a.jsx)(n.h3,{id:"view-logs",children:"View Logs"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View all logs\npm2 logs\n\n# View specific service logs\npm2 logs accessibility-backend\n\n# View last 100 lines\npm2 logs --lines 100\n\n# Follow logs in real-time\npm2 logs --follow\n"})}),"\n",(0,a.jsx)(n.h3,{id:"restart-services",children:"Restart Services"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Restart all services\npm2 restart all\n\n# Restart specific service\npm2 restart accessibility-backend\n\n# Restart with graceful shutdown\npm2 gracefulReload all\n"})}),"\n",(0,a.jsx)(n.h3,{id:"stop-services",children:"Stop Services"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Stop all services\npm2 stop all\n\n# Stop specific service\npm2 stop accessibility-backend\n\n# Stop and delete from PM2\npm2 delete accessibility-backend\n"})}),"\n",(0,a.jsx)(n.h2,{id:"auto-start-on-server-reboot",children:"Auto-Start on Server Reboot"}),"\n",(0,a.jsx)(n.h3,{id:"setup-startup",children:"Setup Startup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Generate startup script\npm2 startup\n\n# Follow the instructions to set up auto-start\n# Usually requires running a sudo command\n\n# Verify setup\npm2 startup systemd -u $USER --hp /home/$USER\n"})}),"\n",(0,a.jsx)(n.h3,{id:"save-configuration",children:"Save Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Save current PM2 configuration\npm2 save\n\n# Restore configuration after reboot\npm2 resurrect\n"})}),"\n",(0,a.jsx)(n.h3,{id:"disable-auto-start",children:"Disable Auto-Start"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Remove startup script\npm2 unstartup systemd -u $USER --hp /home/$USER\n"})}),"\n",(0,a.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,a.jsx)(n.h3,{id:"real-time-monitoring",children:"Real-Time Monitoring"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View real-time resource usage\npm2 monit\n"})}),"\n",(0,a.jsx)(n.h3,{id:"log-rotation",children:"Log Rotation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Install log rotation module\npm2 install pm2-logrotate\n\n# Configure log rotation\npm2 set pm2-logrotate:max_size 10M\npm2 set pm2-logrotate:retain 30\n"})}),"\n",(0,a.jsx)(n.h3,{id:"health-monitoring",children:"Health Monitoring"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View process health\npm2 status\n\n# Check for crashes\npm2 logs --err\n\n# View memory usage\npm2 monit\n"})}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.h3,{id:"service-wont-start",children:"Service Won't Start"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Check logs\npm2 logs\n\n# Check error logs\npm2 logs --err\n\n# Verify configuration\npm2 describe ecosystem.config.js\n\n# Try starting manually\npm2 start ecosystem.config.js --no-daemon\n"})}),"\n",(0,a.jsx)(n.h3,{id:"service-keeps-crashing",children:"Service Keeps Crashing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View crash logs\npm2 logs --err\n\n# Check application logs\npm2 logs accessibility-backend\n\n# Increase restart delay\n# Edit ecosystem.config.js and add:\n# min_memory_restart: '100M'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"high-memory-usage",children:"High Memory Usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View memory usage\npm2 monit\n\n# Set memory limit\n# Edit ecosystem.config.js and add:\n# max_memory_restart: '500M'\n\n# Restart service\npm2 restart all\n"})}),"\n",(0,a.jsx)(n.h3,{id:"port-already-in-use",children:"Port Already in Use"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Find process using port\nsudo lsof -i :3001\n\n# Kill process\nkill -9 <PID>\n\n# Or change port in ecosystem.config.js\n"})}),"\n",(0,a.jsx)(n.h2,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"cluster-mode",children:"Cluster Mode"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'app',\n  script: 'app.js',\n  instances: 4,  // Number of instances\n  exec_mode: 'cluster',\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"watch-mode",children:"Watch Mode"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'app',\n  script: 'app.js',\n  watch: true,  // Restart on file changes\n  ignore_watch: ['node_modules', 'logs'],\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"{\n  name: 'app',\n  script: 'app.js',\n  env: {\n    NODE_ENV: 'production',\n    PORT: 3001,\n  },\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"common-commands",children:"Common Commands"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# List all processes\npm2 list\n\n# View process details\npm2 info <app-name>\n\n# View logs\npm2 logs\n\n# Restart all\npm2 restart all\n\n# Stop all\npm2 stop all\n\n# Delete all\npm2 delete all\n\n# Save configuration\npm2 save\n\n# Restore configuration\npm2 resurrect\n\n# View startup script\npm2 startup\n\n# Remove startup script\npm2 unstartup\n"})}),"\n",(0,a.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./overview",children:"Deployment Overview"})," - Deployment guide"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./production",children:"Production Deployment"})," - Production setup"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./nginx",children:"Nginx Configuration"})," - Nginx setup"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);