"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[1831],{3023:(e,s,i)=>{i.d(s,{R:()=>l,x:()=>o});var n=i(3696);const r={},t=n.createContext(r);function l(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(t.Provider,{value:s},e.children)}},4046:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"authentication","title":"Authentication System","description":"The ICJIA Accessibility Portal uses a custom cookie-based authentication system (not Supabase Auth).","source":"@site/docs/authentication.md","sourceDirName":".","slug":"/authentication","permalink":"/docs/docs/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/authentication.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Complete Setup Guide","permalink":"/docs/docs/setup-guide"},"next":{"title":"Database Schema","permalink":"/docs/docs/database-schema"}}');var r=i(2540),t=i(3023);const l={},o="Authentication System",a={},d=[{value:"Overview",id:"overview",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Login Flow",id:"login-flow",level:3},{value:"Session Validation",id:"session-validation",level:3},{value:"Logout Flow",id:"logout-flow",level:3},{value:"Initial Setup",id:"initial-setup",level:2},{value:"Blank Password Approach",id:"blank-password-approach",level:3},{value:"Automatic Detection",id:"automatic-detection",level:3},{value:"Password Requirements",id:"password-requirements",level:3},{value:"Password Changes",id:"password-changes",level:2},{value:"Security Features",id:"security-features",level:2},{value:"Password Security",id:"password-security",level:3},{value:"Session Security",id:"session-security",level:3},{value:"Database Security",id:"database-security",level:3},{value:"Primary Admin Protection",id:"primary-admin-protection",level:2},{value:"API Key Authentication",id:"api-key-authentication",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;Invalid credentials&quot; error",id:"invalid-credentials-error",level:3},{value:"&quot;Failed to create session&quot; error",id:"failed-to-create-session-error",level:3},{value:"Session not persisting across page refreshes",id:"session-not-persisting-across-page-refreshes",level:3},{value:"&quot;Authentication required&quot; on valid session",id:"authentication-required-on-valid-session",level:3},{value:"Key Files",id:"key-files",level:2},{value:"See Also",id:"see-also",level:2}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"authentication-system",children:"Authentication System"})}),"\n",(0,r.jsxs)(s.p,{children:["The ICJIA Accessibility Portal uses a ",(0,r.jsx)(s.strong,{children:"custom cookie-based authentication system"})," (not Supabase Auth)."]}),"\n",(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Authentication Method"}),": Cookie-based sessions with bcrypt password hashing"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"NOT using:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u274c JWT tokens in localStorage"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Supabase Auth"}),"\n",(0,r.jsx)(s.li,{children:"\u274c Bearer tokens"}),"\n",(0,r.jsx)(s.li,{children:"\u274c OAuth providers"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Using:"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u2705 HttpOnly cookies for session tokens"}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 Custom ",(0,r.jsx)(s.code,{children:"admin_users"})," table for user accounts"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 Custom ",(0,r.jsx)(s.code,{children:"sessions"})," table for session management"]}),"\n",(0,r.jsx)(s.li,{children:"\u2705 bcrypt for password hashing (10 salt rounds)"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Supabase as a PostgreSQL database (not for auth)"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsx)(s.h3,{id:"login-flow",children:"Login Flow"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"User submits username and password"}),"\n",(0,r.jsxs)(s.li,{children:["Backend queries ",(0,r.jsx)(s.code,{children:"admin_users"})," table"]}),"\n",(0,r.jsx)(s.li,{children:"Password compared with bcrypt hash"}),"\n",(0,r.jsx)(s.li,{children:"Cryptographically random session token generated"}),"\n",(0,r.jsx)(s.li,{children:"Session stored in database (expires in 15 days)"}),"\n",(0,r.jsx)(s.li,{children:"HttpOnly cookie set with session token"}),"\n",(0,r.jsx)(s.li,{children:"Browser automatically sends cookie with every request"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"session-validation",children:"Session Validation"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Backend extracts session token from cookie"}),"\n",(0,r.jsxs)(s.li,{children:["Queries ",(0,r.jsx)(s.code,{children:"sessions"})," table"]}),"\n",(0,r.jsx)(s.li,{children:"Checks if session exists and is not expired"}),"\n",(0,r.jsx)(s.li,{children:"Attaches user_id to request"}),"\n",(0,r.jsx)(s.li,{children:"Continues to protected route"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"logout-flow",children:"Logout Flow"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Session token extracted from cookie"}),"\n",(0,r.jsx)(s.li,{children:"Session deleted from database"}),"\n",(0,r.jsx)(s.li,{children:"Cookie cleared"}),"\n",(0,r.jsx)(s.li,{children:"User redirected to login page"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"initial-setup",children:"Initial Setup"}),"\n",(0,r.jsx)(s.h3,{id:"blank-password-approach",children:"Blank Password Approach"}),"\n",(0,r.jsxs)(s.p,{children:["The initial admin account is created with a ",(0,r.jsx)(s.strong,{children:"blank/empty password"}),". This approach:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u2705 Prevents hardcoded passwords in the repository"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Eliminates default credential risks"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Forces immediate password setup"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Protects against GitHub exposure"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 One-time use only"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"automatic-detection",children:"Automatic Detection"}),"\n",(0,r.jsx)(s.p,{children:"When you first open the app:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"App detects blank admin password"}),"\n",(0,r.jsxs)(s.li,{children:["User is automatically redirected to ",(0,r.jsx)(s.code,{children:"/setup"})]}),"\n",(0,r.jsx)(s.li,{children:"User sets a secure password"}),"\n",(0,r.jsx)(s.li,{children:"User is redirected to login page"}),"\n",(0,r.jsx)(s.li,{children:"User logs in with new credentials"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"password-requirements",children:"Password Requirements"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u2705 Cannot be blank/empty"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Minimum 8 characters"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 At least one uppercase letter"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 At least one lowercase letter"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 At least one number"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 At least one special character"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"password-changes",children:"Password Changes"}),"\n",(0,r.jsx)(s.p,{children:"After initial setup, users can change their password:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"User navigates to password change page"}),"\n",(0,r.jsx)(s.li,{children:"Enters current password (for verification)"}),"\n",(0,r.jsx)(s.li,{children:"Enters new password (must meet requirements)"}),"\n",(0,r.jsx)(s.li,{children:"Confirms new password"}),"\n",(0,r.jsx)(s.li,{children:"All existing sessions are cleared (forces re-login)"}),"\n",(0,r.jsx)(s.li,{children:"User logs in with new password"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"security-features",children:"Security Features"}),"\n",(0,r.jsx)(s.h3,{id:"password-security",children:"Password Security"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"bcrypt hashing"})," with 10 salt rounds"]}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Passwords never stored in plain text"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Hashes cannot be reversed"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"session-security",children:"Session Security"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"Cryptographically random tokens"})," (32 bytes = 256 bits)"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"HttpOnly cookies"})," - JavaScript cannot access (XSS protection)"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"Secure flag"})," in production - HTTPS only"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"SameSite: lax"})," - CSRF protection"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"15-day expiration"})," - Sessions automatically expire"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"Server-side validation"})," - Every request validates against database"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"database-security",children:"Database Security"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"Row Level Security (RLS)"})," enabled on all tables"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"Prepared statements"})," via Supabase client (SQL injection protection)"]}),"\n",(0,r.jsxs)(s.li,{children:["\u2705 ",(0,r.jsx)(s.strong,{children:"Anon key"})," has limited permissions"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"primary-admin-protection",children:"Primary Admin Protection"}),"\n",(0,r.jsxs)(s.p,{children:["The first admin user created (oldest ",(0,r.jsx)(s.code,{children:"created_at"})," timestamp) is protected from deletion:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"\u2705 Cannot be deleted via API"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Cannot be deleted via admin panel"}),"\n",(0,r.jsx)(s.li,{children:'\u2705 UI shows "Primary Admin" badge'}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Delete button is disabled for primary admin"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Prevents system lockout"}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Why?"})," If the primary admin is deleted, no one can access the system. This protection ensures at least one admin always exists."]}),"\n",(0,r.jsx)(s.h2,{id:"api-key-authentication",children:"API Key Authentication"}),"\n",(0,r.jsx)(s.p,{children:"API keys are separate from user authentication:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\u2705 API keys stored in ",(0,r.jsx)(s.code,{children:"api_keys"})," table"]}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Each key has specific scopes (read, write, delete)"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Keys can be revoked at any time"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 Usage tracked in activity log"}),"\n",(0,r.jsx)(s.li,{children:"\u2705 IP address and user agent logged for audit trail"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(s.h3,{id:"invalid-credentials-error",children:'"Invalid credentials" error'}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Check that the migration file was run"}),"\n",(0,r.jsx)(s.li,{children:"The initial admin account has a BLANK password"}),"\n",(0,r.jsx)(s.li,{children:"You must set it on first login via the Initial Setup page"}),"\n",(0,r.jsxs)(s.li,{children:["Run ",(0,r.jsx)(s.code,{children:"yarn tsx diagnose-auth.ts"})," to check database"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"failed-to-create-session-error",children:'"Failed to create session" error'}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Database migration may not have completed successfully"}),"\n",(0,r.jsxs)(s.li,{children:["Re-run ",(0,r.jsx)(s.code,{children:"supabase/migrations/step_1_create_initial_schema.sql"})]}),"\n",(0,r.jsx)(s.li,{children:"RLS policies are pre-configured in the migration file"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"session-not-persisting-across-page-refreshes",children:"Session not persisting across page refreshes"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Check that ",(0,r.jsx)(s.code,{children:"credentials: 'include'"})," is set in fetch requests"]}),"\n",(0,r.jsx)(s.li,{children:"Verify cookies are enabled in browser"}),"\n",(0,r.jsx)(s.li,{children:"Check that backend is setting cookies correctly"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"authentication-required-on-valid-session",children:'"Authentication required" on valid session'}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Session may have expired (15 days)"}),"\n",(0,r.jsx)(s.li,{children:"Session may have been deleted from database"}),"\n",(0,r.jsx)(s.li,{children:"Cookie may have been cleared by browser"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"key-files",children:"Key Files"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"server/routes/auth.ts"})})," - Login, logout, session validation endpoints"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"server/middleware/auth.ts"})})," - ",(0,r.jsx)(s.code,{children:"requireAuth"})," middleware for protected routes"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"src/contexts/AuthContext.tsx"})})," - Frontend authentication state management"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"src/lib/api.ts"})})," - API client with ",(0,r.jsx)(s.code,{children:"credentials: 'include'"})]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"server/utils/supabase.ts"})})," - Supabase client configuration"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"./setup-guide",children:"Setup Guide"})," - How to set up the system"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"./reset-scripts",children:"Reset Scripts"})," - How to reset admin users"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"./troubleshooting/common-issues",children:"Troubleshooting"})," - Common issues and solutions"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);